# ‚úÖ Employee Update Issue - –†–ï–®–ï–ù–û!

## ~~–ü—Ä–æ–±–ª–µ–º–∞~~ - –ò–°–ü–†–ê–í–õ–ï–ù–û

~~–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –†–∞–±–æ—á–∏–µ", backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É **405 Method Not Allowed**.~~

**–†–µ—à–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ!** Backend –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è.

---

## –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ–±–ª–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Frontend (React)                             ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  handleUpdate() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "O'zgartirish"           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  1Ô∏è‚É£ updateUser.mutateAsync({                                    ‚îÇ
‚îÇ      id: 2,                                                      ‚îÇ
‚îÇ      first_name: "–ò–≤–∞–Ω",                                         ‚îÇ
‚îÇ      email: "ivan@example.com",                                  ‚îÇ
‚îÇ      username: "ivan123",                                        ‚îÇ
‚îÇ      password: "NewPassword123"                                  ‚îÇ
‚îÇ    })                                                            ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ    ‚Üì –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç                                                 ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ    PATCH /api/users/users/2/                                    ‚îÇ
‚îÇ    Body: { first_name, email, username, password }              ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Backend (Django)                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ    ‚ùå 405 Method Not Allowed                                     ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ    {                                                              ‚îÇ
‚îÇ      "status": "error",                                           ‚îÇ
‚îÇ      "message": "–î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ           ‚îÇ
‚îÇ                  PATCH /api/users/users/{id}/update-employee/"   ‚îÇ
‚îÇ    }                                                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Frontend (React)                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ    ‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —É–ø–∞–ª, –≤—Ç–æ—Ä–æ–π –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è                 ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  2Ô∏è‚É£ updateEmployee.mutateAsync({  ‚Üê –ù–ï –í–´–ü–û–õ–ù–ò–õ–°–Ø                ‚îÇ
‚îÇ      id: 2,                                                       ‚îÇ
‚îÇ      phone: "+998901234567"                                       ‚îÇ
‚îÇ    })                                                             ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Frontend –°—Ç–∞—Ç—É—Å: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

Frontend –∫–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω –ø–æ–¥ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É API –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç—Ä–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞**:

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç frontend:

1. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å:** PATCH `/api/users/users/{id}/`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –ø–æ–ª—è: `username`, `email`, `first_name` **–ë–ï–ó password**
   - –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `password`, `phone`, `role`, `sex`

2. **–í—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å:** POST `/api/users/users/{id}/change-password/`
   - –ò–∑–º–µ–Ω—è–µ—Ç –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `new_password`

3. **–¢—Ä–µ—Ç–∏–π –∑–∞–ø—Ä–æ—Å:** PATCH `/api/users/users/{id}/update-employee/`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç employee –ø–æ–ª—è: `phone`, `role`, `position`, `is_active`

### –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–¥:

- **API –º–µ—Ç–æ–¥—ã:** [src/entities/cashier/api/usersApi.ts:33-66](src/entities/cashier/api/usersApi.ts#L33-L66)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** [src/pages/Settings/ui/Seller/index.tsx:193-229](src/pages/Settings/ui/Seller/index.tsx#L193-L229)
- **Hook –¥–ª—è updateEmployee:** [src/entities/cashier/model/useUpdateEmployee.ts](src/entities/cashier/model/useUpdateEmployee.ts)
- **Hook –¥–ª—è changePassword:** [src/entities/cashier/model/useChangePassword.ts](src/entities/cashier/model/useChangePassword.ts)

---

## Backend –†–µ—à–µ–Ω–∏–µ: ‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–∞—Ä–æ–ª—è

Backend –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è:

**POST `/api/users/users/{id}/change-password/`**

```json
{
  "new_password": "NewSecurePass123!"
}
```

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
- ‚úÖ `owner` –∏ `manager` - –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –ø–∞—Ä–æ–ª–∏
- ‚ùå `cashier` –∏ `stockkeeper` - –Ω–µ –º–æ–≥—É—Ç

**–¢–µ–ø–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–∫–∞—è:**
1. `/users/users/{id}/` - –¥–ª—è username, email, first_name
2. `/change-password/` - –¥–ª—è –ø–∞—Ä–æ–ª—è
3. `/update-employee/` - –¥–ª—è phone, role, position

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:

```typescript
function handleUpdate() {
  // –í–∞–ª–∏–¥–∞—Ü–∏—è...

  const normalizedPhone = normalizePhone(phone);

  // –®–∞–≥ 1: –û–±–Ω–æ–≤–ª—è–µ–º User (–ë–ï–ó –ø–∞—Ä–æ–ª—è)
  updateUser
    .mutateAsync({
      id: updateId,
      first_name: name,
      email,
      username: login,
    })
    .then((res) => {
      if (res.status === 200) {
        // –®–∞–≥ 2: –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–æ–ª—å
        return changePassword.mutateAsync({
          id: updateId,
          new_password: password,
        });
      }
      throw new Error("Failed to update user");
    })
    .then((res) => {
      if (res.status === 200) {
        // –®–∞–≥ 3: –û–±–Ω–æ–≤–ª—è–µ–º Employee
        return updateEmployee.mutateAsync({
          id: updateId,
          phone: normalizedPhone,
        });
      }
      throw new Error("Failed to change password");
    })
    .then(() => {
      setIsOpenUpdate(false);
      clearData();
    })
    .catch((error) => {
      console.error("Update error:", error);
      setError("Xatolik yuz berdi. Qaytadan urinib ko'ring.");
    });
}
```

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã, —Å–º.:

1. **[UPDATE_USER_STATUS.md](UPDATE_USER_STATUS.md)** üìã
   - –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ö–æ–¥ –ø—Ä–∏–º–µ—Ä—ã
   - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

2. **[DEBUG_UPDATE_REQUEST.md](DEBUG_UPDATE_REQUEST.md)** üîç
   - –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ DevTools
   - Checklist –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   - –ß—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

3. **[API_UPDATE_GUIDE.md](API_UPDATE_GUIDE.md)** üìñ
   - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ API –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

4. **[FINAL_STATUS.md](FINAL_STATUS.md)** üéØ
   - –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
   - Known Issues

---

## TL;DR

### –î–ª—è Frontend:
‚úÖ –ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª—ë–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `changePassword` –≤ API
- –°–æ–∑–¥–∞–Ω —Ö—É–∫ `useChangePassword`
- –û–±–Ω–æ–≤–ª—ë–Ω `handleUpdate` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä—ë—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### –î–ª—è Backend:
‚úÖ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç `/change-password/`
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `new_password`
- –î–æ—Å—Ç—É–ø –¥–ª—è owner –∏ manager
- –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
üéâ **–í–°–Å –†–ê–ë–û–¢–ê–ï–¢!** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç.

---

**–î–∞—Ç–∞:** 17 –Ω–æ—è–±—Ä—è 2025
**–°—Ç–∞—Ç—É—Å Frontend:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
**–°—Ç–∞—Ç—É—Å Backend:** ‚úÖ API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
**–°—Ç–∞—Ç—É—Å Issue:** ‚úÖ –†–ï–®–ï–ù–û
